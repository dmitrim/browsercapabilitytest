class GcComponent extends HTMLElement{constructor(){super(),this.id=this.id||(()=>{function t(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return`c${t()}${t()}${t()}${t()}${t()}${t()}${t()}${t()}`})(),this._cache={events:{}},this.useNativeShadow=window.customElements.toString().includes("CustomElementRegistry"),this.useNativeShadow?this.shadowSelector=":host":this.shadowSelector=`#${this.id}`}$(t){return this.querySelector(t)}$$(t){return this.querySelectorAll(t)}fireEvent(t,e,o=!0){const i=JSON.stringify(arguments);if(!(i in this._cache.events)){const n={bubbles:o};n.detail=e,this._cache.events[i]=new CustomEvent(t,n)}this.dispatchEvent(this._cache.events[i])}makeShadow(t={}){this.useNativeShadow?this.attachShadow({mode:"open"}):this.shadowRoot=this,this.shadowRoot.$=(t=>this.shadowRoot.querySelector(t)),this.shadowRoot.$$=(t=>new CustomNodeList(this.shadowRoot.querySelectorAll(t)))}getNativeElement(){return this}getOuterSize(){return this.getElementOuterSize(this.getNativeElement())}getInnerSize(){return this.getElementInnerSize(this.getNativeElement())}getElementOuterSize(t){try{let e,o,i=getComputedStyle(t);return"BODY"===t.tagName?(e=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,o=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth):(e=t.offsetHeight,o=t.offsetWidth),e+=parseFloat(i.marginTop)+parseFloat(i.marginBottom),{w:o+=parseFloat(i.marginLeft)+parseFloat(i.marginRight),h:e}}catch(e){return{w:t.offsetWidth,h:t.offsetHeight}}}getElementInnerSize(t){try{let e,o,i=getComputedStyle(t);return"BODY"===t.tagName?(e=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,o=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,e-=parseFloat(i.marginTop)+parseFloat(i.marginBottom),o-=parseFloat(i.marginLeft)+parseFloat(i.marginRight)):(e=t.offsetHeight,o=t.offsetWidth),e-=parseFloat(i.paddingTop)+parseFloat(i.paddingBottom),{w:o-=parseFloat(i.paddingLeft)+parseFloat(i.paddingRight),h:e}}catch(e){return{w:t.offsetWidth,h:t.offsetHeight}}}}class GcPdfButton extends GcComponent{attributeChangedCallback(t,e,o){switch(t){case"title":this.elementA.title=o;break;case"icon":this.update()}}static get observedAttributes(){return["title","icon"]}get icon(){return this.getAttribute("icon")||""}set icon(t){t?this.setAttribute("icon",t):this.removeAttribute("icon")}constructor(){super();let t=`${this.shadowSelector} a { margin-left: 5px; margin-right: 5px; text-decoraton: none; color: #ffffff; fill: #ffffff; stroke: #ffffff; width: 25px; height: 25px; display: inline-block; }`;this.text||(this.text=this.textContent),this.makeShadow(),this.shadowRoot.innerHTML=`<style>${t}</style>\n            <a href="#" class="gc-pdfbutton" title="${this.title}">${this.text}</a>`,this.elementA=this.shadowRoot.$("a"),this.elementA.onclick=(()=>!1)}update(){if(this.icon)switch(this.icon){case"svg:rotate":this.elementA.innerHTML='<svg viewBox="0 0 24 24" preserveAspectRatio="xMidYMid meet" focusable="false" style="pointer-events: none; display: block; width: 100%; height: 100%;">\n<g>\n<path d="M15.55 5.55L11 1v3.07C7.06 4.56 4 7.92 4 12s3.05 7.44 7 7.93v-2.02c-2.84-.48-5-2.94-5-5.91s2.16-5.43 5-5.91V10l4.55-4.45zM19.93 11c-.17-1.39-.72-2.73-1.62-3.89l-1.42 1.42c.54.75.88 1.6 1.02 2.47h2.02zM13 17.9v2.02c1.39-.17 2.74-.71 3.9-1.61l-1.44-1.44c-.75.54-1.59.89-2.46 1.03zm3.89-2.42l1.42 1.41c.9-1.16 1.45-2.5 1.62-3.89h-2.02c-.14.87-.48 1.72-1.02 2.48z"></path>\n</g></svg>';break;case"svg:download":this.elementA.innerHTML='<svg viewBox="0 0 24 24" preserveAspectRatio="xMidYMid meet" focusable="false" style="pointer-events: none; display: block; width: 100%; height: 100%;">\n<g><path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"></path></g></svg>';break;case"svg:openfile":this.elementA.innerHTML='<svg viewBox="0 0 24 24" preserveAspectRatio="xMidYMid meet" focusable="false" style="pointer-events: none; display: block; width: 100%; height: 100%;">\n<g>\n<path d="M19.54369321107791,9.63552147172598 c-0.17532659320111435,-0.21860341051025028 -0.4409056942947855,-0.34621453847308664 -0.7212802884855972,-0.34621453847308664 H17.897694604021034 c0,-0.5108143991787741 -0.4139039193925041,-0.9247183185712783 -0.9247183185712783,-0.9247183185712783 H16.048257966878477 V7.4398702961103425 C16.048257966878477,6.929055896931565 15.634354047485974,6.5151519775390625 15.123539648307197,6.5151519775390625 h-11.096619822855338 C3.5161054262730858,6.5151519775390625 3.102201506880583,6.929055896931565 3.102201506880583,7.4398702961103425 v11.096619822855338 C3.102201506880583,19.047304518144458 3.5161054262730858,19.461208437536953 4.026919825451859,19.461208437536953 h1.8494366371425563 h9.247183185712782 h1.8494366371425563 c0.43350794774621526,0 0.809313472413583,-0.3010882845268084 0.9021551915981392,-0.7242393871050251 l1.8494366371425563,-8.322464867141504 C19.785969410543586,10.140787560993331 19.71938969160645,9.854124882236235 19.54369321107791,9.63552147172598 zM4.026919825451859,7.4398702961103425 h11.096619822855338 V8.364588614681622 H14.198821329735921 c-0.5108143991787741,0 -0.9247183185712783,0.4139039193925041 -0.9247183185712783,0.9247183185712783 h-5.548309911427669 c-0.43350794774621526,0 -0.8085736977587256,0.3010882845268084 -0.9025250789255677,0.7242393871050251 c0,0 -1.8708901021334103,8.456364079670625 -1.8708901021334103,8.522943798607757 H4.026919825451859 V7.4398702961103425 L4.026919825451859,7.4398702961103425 z" id="svg_2"></path>\n</g></svg>'}}}customElements.define("gc-pdfbutton",GcPdfButton);class GcPdfViewerToolbar extends GcComponent{attributeChangedCallback(t,e,o){switch(t){case"currentpage":this.elementCurrentPage.innerHTML=o;case"pagescount":this.elementPagesCount.innerHTML=o;case"title":this.theTitle.innerHTML=o;break;case"width":this.theToolbar.style.width=o}}static get observedAttributes(){return["currentpage","pagescount","title","width"]}getNativeElement(){return this.theToolbar}get currentpage(){if(!this.getAttribute("currentpage"))return 1}set currentpage(t){this.setAttribute("currentpage",t)}get height(){return this.getAttribute("height")}set height(t){t?this.setAttribute("height",t):this.removeAttribute("height")}get pagescount(){if(!this.getAttribute("pagescount"))return 0}set pagescount(t){this.setAttribute("pagescount",t)}get title(){return this.getAttribute("title")}set title(t){t?this.setAttribute("title",t):this.removeAttribute("title")}get width(){return this.getAttribute("width")}set width(t){t?this.setAttribute("width",t):this.removeAttribute("width")}constructor(){super();let t=":host .toolbar{width:100%;height: 45px; line-height: 45px; overflow:hidden; background: #323639; color: white; position:relative;} \n                        :host .buttons {float:right;margin-top: 8px;}\n                          :host .title {width: 38%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; display: inline-block;}\n                          :host .pageselector { position: absolute; left: 49%; } \n                          :host span.spacer-left {width: 20px;height:1px;float:left;} :host span.spacer-right {width: 20px;height:1px;float:right;}";t=t.replace(":host",this.shadowSelector),this.makeShadow(),this.shadowRoot.innerHTML=`<style>${t}</style>\n            <div class="toolbar">\n                    <span class="spacer-left"></span>\n                    <span class="title">                        \n                    </span>\n                    <span class="spacer-right"></span>\n                    <span class="pageselector">\n                        <span class="currentpage">0</span><span>/</span><span class="pagescount">1</span>\n                    </span>                    \n                    <span class="buttons">\n                        <gc-pdfbutton class="rotate-doc" icon="svg:rotate" text="Rotate" title="Rotate PDF"></gc-pdfbutton>\n                        <gc-pdfbutton class="download-doc" icon="svg:download" text="Download" title="Download PDF"></gc-pdfbutton>\n                        <gc-pdfbutton class="open-doc" icon="svg:openfile" title="Open PDF"></gc-pdfbutton>\n                    </span>\n                \n            </div>`,this.theStyle=this.shadowRoot.$("style"),this.theTitle=this.shadowRoot.$(".title"),this.theTitle.innerHTML="",this.theToolbar=this.shadowRoot.$(".toolbar"),this.elementCurrentPage=this.shadowRoot.$(".currentpage"),this.elementPagesCount=this.shadowRoot.$(".pagescount"),this.elementRotateDoc=this.shadowRoot.$(".rotate-doc"),this.elementDownloadDoc=this.shadowRoot.$(".download-doc"),this.elementOpenDoc=this.shadowRoot.$(".open-doc"),this.elementRotateDoc.addEventListener("click",()=>{this.fireEvent("action","rotate")}),this.elementDownloadDoc.addEventListener("click",()=>{this.fireEvent("action","download")}),this.elementOpenDoc.addEventListener("click",()=>{this.fireEvent("action","open")})}}customElements.define("gc-pdftoolbar",GcPdfViewerToolbar);class GcPdfViewer extends GcComponent{attributeChangedCallback(t,e,o){switch(t){case"file":this.loadFromUrl(o);break;case"pagenum":this.loadPage(1*o);break;case"width":case"height":this.update();break;case"zoom-buttons":this.elementZoomButtons.style.display="hidden"===o?"none":"block"}}static get observedAttributes(){return["file","pagenum","width","height","zoomButtons"]}getNativeElement(){return this.elementContainer}get pagesCache(){return this.pagesCache||(this.pagesCache=new GcPagesCache),this.pagesCache}get width(){return this.getAttribute("width")}set width(t){t?this.setAttribute("width",t):this.removeAttribute("width")}get height(){return this.getAttribute("height")}set height(t){t?this.setAttribute("height",t):this.removeAttribute("height")}get file(){return this.getAttribute("file")}set file(t){t?this.setAttribute("file",t):this.removeAttribute("file")}get pagenum(){const t=this.getAttribute("pagenum");return t||1}set pagenum(t){this.setAttribute("pagenum",t)}get zoomButtons(){const t=this.getAttribute("zoom-buttons");return t||"visible"}set zoomButtons(t){this.setAttribute("zoom-buttons",t)}constructor(){super(),this.pdfjsLib=window["pdfjs-dist/build/pdf"];let t=`\n                    :host .container { position: relative; width:${this.getAttribute("width")||"100%"}; height:${this.getAttribute("height")||"100%"}; overflow: hidden; }\n                    :host .scrollview{ overflow:auto; } \n                    :host canvas { } \n                    :host .zoom-buttons { position: absolute; bottom: 20px; right: 20px; width: 55px; height: 150px; display: none; } \n                    :host .zoom-buttons a { width: 50px; height: 50px; line-height: 50px; text-align: center; display: inline-block; } `;t=t.replace(":host",this.shadowSelector),this.makeShadow(),this.shadowRoot.innerHTML=`<style>${t}</style>\n                  <div class="container">\n                    <gc-pdftoolbar></gc-pdftoolbar>\n                    <div class="scrollview">\n                        <canvas></canvas>\n                    </div>\n                    <div class="zoom-buttons">\n                        <a class="zoom-fit" text="Fit" is="gc-link-button" />\n                        <a class="zoom-in" text="+" is="gc-link-button" />\n                        <a class="zoom-out" text="-" is="gc-link-button" />    \n                    </div>\n                  </div>`,this.theCanvas=this.shadowRoot.$("canvas"),this.elementContainer=this.shadowRoot.$(".container"),this.elementScrollView=this.shadowRoot.$(".scrollview"),this.elementZoomButtons=this.shadowRoot.$(".zoom-buttons"),"hidden"!==this.zoomButtons&&(this.elementZoomButtons.style.display="block",this.shadowRoot.$(".zoom-fit").addEventListener("click",()=>this.tool_zoomFit),this.shadowRoot.$(".zoom-in").addEventListener("click",()=>this.tool_zoomIn),this.shadowRoot.$(".zoom-out").addEventListener("click",()=>this.tool_zoomOut)),this.elementToolbar=this.shadowRoot.$("gc-pdftoolbar"),this.elementToolbar.addEventListener("action",t=>this[`tool_${t.detail||"unknown"}`]()),window.GrabToPan&&(this.elementScrollView.style.cursor="pointer",this.grabToPan=new window.GrabToPan({element:this.elementScrollView}),this.grabToPan.activate()),window.addEventListener("resize",t=>{this.onResize()})}load(t){console.log("TODO: implement caching and other staff for load(pdfDocument)");try{this.pdfDocument=t,this.updateToolbar(),this.loadPage(this.pagenum),this.fireEvent("documentload"),this.update()}catch(t){this._loadingLock=!1,console.log(`Error: ${t}`)}}close(){console.log("todo: implement close");var t=this.pdfLoadingTask.destroy();return this.pdfLoadingTask=null,t}open(t,e){if(this.pdfLoadingTask)return this.close().then(()=>this.open(t,e));var o=Object.create(null);"string"==typeof t?(this.setTitleUsingUrl(t),o.url=t):t&&"byteLength"in t?o.data=t:t.url&&t.originalUrl&&(this.setTitleUsingUrl(t.originalUrl),o.url=t.url);var i=(0,this.pdfjsLib.getDocument)(o);return this.pdfLoadingTask=i,i.onPassword=((t,e)=>{this.passwordPrompt.setUpdateCallback(t,e),this.passwordPrompt.open()}),i.onProgress=(t=>{var e=t.loaded,o=t.total;this.progress(e/o)}),i.then(t=>{console.log(`pdfDocument ready! ${t}`),this.load(t)},t=>{i===this.pdfLoadingTask&&console.error(t)})}update(){this.height||(console.log(this.getElementInnerSize(this.parentNode)),this.elementContainer.style.height=`${this.getElementInnerSize(this.parentNode).h}px`);let t=this.getElementOuterSize(this.elementContainer).h-this.elementToolbar.getOuterSize().h;console.log(`scrollViewHeight:::::::${t} container h:${this.getElementOuterSize(this.elementContainer).h}, toolbar h: ${this.elementToolbar.getOuterSize().h}`),this.elementScrollView.style.height=`${t}px`}loadPage(t){console.log(`loadPage ${t}`),this.pdfDocument.getPage(t).then(e=>{this.updateToolbar(),this.currentScaleValue;var o=e.getViewport(1),i=this.theCanvas.getContext("2d");this.theCanvas.height=o.height,this.theCanvas.width=o.width;var n={canvasContext:i,viewport:o};e.render(n).then(()=>{console.log("Page rendered"),this._loadingLock=!1,this.fireEvent("pagerendered",t)})})}progress(t){console.log(`Load progress: ${t}%`)}webViewerUpdateViewarea(t){var e=t.location,o=PDFViewerApplication.store;o&&PDFViewerApplication.isInitialViewSet&&o.setMultiple({page:e.pageNumber,zoom:e.scale,scrollLeft:e.left,scrollTop:e.top,rotation:e.rotation}).catch(function(){});var i=PDFViewerApplication.pdfLinkService.getAnchorUrl(e.pdfOpenParams);PDFViewerApplication.appConfig.toolbar.viewBookmark.href=i,PDFViewerApplication.appConfig.secondaryToolbar.viewBookmarkButton.href=i;var n=PDFViewerApplication.pdfViewer.getPageView(PDFViewerApplication.page-1).renderingState!==_pdf_rendering_queue.RenderingStates.FINISHED;PDFViewerApplication.toolbar.updateLoadingIndicatorState(n)}onResize(){if(console.log("onResize"),!this.pdfDocument)return;let t=this.currentScaleValue;"auto"!==t&&"page-fit"!==t&&"page-width"!==t||(this.currentScaleValue=t),this.update()}updateLocation(t){var e=this._currentScale,o=this._currentScaleValue,i=parseFloat(o)===e?Math.round(1e4*e)/100:o,n=t.id,s="#page="+n;s+="&zoom="+i;var a=this._pages[n-1],r=this.container,l=a.getPagePoint(r.scrollLeft-t.x,r.scrollTop-t.y),h=Math.round(l[0]),d=Math.round(l[1]);s+=","+h+","+d,this._location={pageNumber:n,scale:i,top:d,left:h,rotation:this._pagesRotation,pdfOpenParams:s}}tool_rotate(){console.log("todo: rotate")}tool_zoomFit(){console.log("tool_zoomFit TODO.");let t=this.pdfViewer.currentScale;do{t=(t*DEFAULT_SCALE_DELTA).toFixed(2),t=Math.ceil(10*t)/10,t=Math.min(_ui_utils.MAX_SCALE,t)}while(--ticks>0&&t<_ui_utils.MAX_SCALE);this.currentScaleValue=t}tool_zoomIn(t){console.log("tool_zoomIn TODO.");let e=this.pdfViewer.currentScale;do{e=(e*DEFAULT_SCALE_DELTA).toFixed(2),e=Math.ceil(10*e)/10,e=Math.min(_ui_utils.MAX_SCALE,e)}while(--t>0&&e<_ui_utils.MAX_SCALE);this.pdfViewer.currentScaleValue=e}tool_zoomOut(t){console.log("tool_zoomOut TODO.");var e=this.pdfViewer.currentScale;do{e=(e/DEFAULT_SCALE_DELTA).toFixed(2),e=Math.floor(10*e)/10,e=Math.max(_ui_utils.MIN_SCALE,e)}while(--t>0&&e>_ui_utils.MIN_SCALE);this.pdfViewer.currentScaleValue=e}tool_download(){console.log("tool_download");this.pdfDocument.getData().then(t=>{let e=new Blob([t],{type:"application/pdf"});console.log(`blob ready to download ${e}`);let o=`${this.elementToolbar.title}`;o.endsWith(".pdf")||(o=`${o}.pdf`),((t,e)=>{var o=document.createElement("a");if(!o.click)throw new Error('DownloadManager: "a.click()" is not supported.');o.style="display: none",o.href=t,o.target="_parent","download"in o&&(o.download=e),(document.body||document.documentElement).appendChild(o),o.click(),o.remove()})(window.URL.createObjectURL(e),o)})}tool_open(){console.log("tool_open");const t=`gcCommonOpenfileInput${this.id}`;if(!document.getElementById(t)){let e=document.createElement("input");e.id=t,e.className="fileInput",e.setAttribute("type","file"),e.style="position: absolute;left:-200px;top:-200px;width:1px;height:1px;",document.body.appendChild(e),window.File&&window.FileReader&&window.FileList&&window.Blob&&(e.value=null),e.addEventListener("change",t=>{var e=t.target.files;if(!e||0===e.length)return;console.log(`got file:${t.target}`);let o=new FileReader;o.onload=(t=>{let e=t.target.result;this.open(new Uint8Array(e))});var i=e[0];console.log(`file: ${i} file.name: ${i.name}`),o.readAsArrayBuffer(i)})}document.getElementById(t).click()}loadFromUrl(t){(this.pdfDocument=null,this.pdfjsLib)?this._loadingLock?console.log("already laoading.."):(this._loadingLock=!0,this.pdfUrl=t,this.pdfjsLib.getDocument(this.pdfUrl).promise.then(t=>{try{this.pdfDocument=t,this.updateToolbar(),this.loadPage(this.pagenum),this.fireEvent("documentload"),this.update()}catch(t){this._loadingLock=!1,console.log(`Error: ${t}`)}},t=>{this._loadingLock=!1,console.error(`PDF loading error: ${t}`)})):console.error("pdfjsLib not found")}updateToolbar(){console.log(`---\x3eupdateToolbar ${this.elementToolbar}`),this.elementToolbar.width=this.elementScrollView.style.width,this.pdfDocument.getMetadata().then(({info:t={Title:Title,Author:Author,Subject:Subject,Keywords:Keywords,Creator:Creator,Producer:Producer,PDFFormatVersion:PDFFormatVersion},metadata:e={},contentDispositionFilename:o}={})=>{this.elementToolbar.title=t.Title||this.pdfUrl}).catch(t=>{console.error(`getMetadata error: ${t}`)}),this.elementToolbar.currentpage=this.pagenum,this.elementToolbar.pagescount=this.pdfDocument.numPages}}customElements.define("gc-pdfviewer",GcPdfViewer);