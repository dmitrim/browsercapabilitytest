"use strict";var _createClass=function(){function n(t,e){for(var o=0;o<e.length;o++){var n=e[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,o){return e&&n(t.prototype,e),o&&n(t,o),t}}(),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}!function(){function t(){this.a=new Map,this.j=new Map,this.h=new Map,this.o=new Set,this.C=new MutationObserver(this.D.bind(this)),this.f=null,this.F=new Set,this.enableFlush=!0,this.s=!1,this.m=null}function r(){return e.customElements}function l(t){if(!/^[a-z][.0-9_a-z]*-[\-.0-9_a-z]*$/.test(t)||-1!==i.indexOf(t))return Error("The element name '"+t+"' is not valid.")}function o(t,e,o,n){var i=r();return t=o?c.call(t,e,o):c.call(t,e),(e=i.a.get(e.toLowerCase()))&&i.u(t,e,n),i.b(t),t}function n(t,e,o,n){e=e.toLowerCase();var i=t.getAttribute(e);n.call(t,e,o),1==t.__$CE_upgraded&&(o=(n=r().a.get(t.localName)).A,(n=n.i)&&0<=o.indexOf(e)&&((o=t.getAttribute(e))!==i&&n.call(t,e,i,o,null)))}var a=document,e=window;if(!r()||(r().g=function(){},r().forcePolyfill)){var i="annotation-xml color-profile font-face font-face-src font-face-uri font-face-format font-face-name missing-glyph".split(" ");t.prototype.L=function(t,e){function o(t){var e=i[t];if(void 0!==e&&"function"!=typeof e)throw Error(n+" '"+t+"' is not a Function");return e}if("function"!=typeof e)throw new TypeError("constructor must be a Constructor");if(r=l(t))throw r;if(this.a.has(t))throw Error("An element with name '"+t+"' is already defined");if(this.j.has(e))throw Error("Definition failed for '"+t+"': The constructor is already used.");var n=t,i=e.prototype;if("object"!==(void 0===i?"undefined":_typeof(i)))throw new TypeError("Definition failed for '"+t+"': constructor.prototype must be an object");var r=o("connectedCallback"),a=o("disconnectedCallback"),s=o("attributeChangedCallback");this.a.set(n,{name:t,localName:n,constructor:e,v:r,w:a,i:s,A:s&&e.observedAttributes||[]}),this.j.set(e,n),this.K(),(t=this.h.get(n))&&(t.resolve(void 0),this.h.delete(n))},t.prototype.get=function(t){return(t=this.a.get(t))?t.constructor:void 0},t.prototype.M=function(t){if(n=l(t))return Promise.reject(n);if(this.a.has(t))return Promise.resolve();if(n=this.h.get(t))return n.N;var e,o=new Promise(function(t){e=t}),n={N:o,resolve:e};return this.h.set(t,n),o},t.prototype.g=function(){this.enableFlush&&(this.l(this.m.takeRecords()),this.D(this.C.takeRecords()),this.o.forEach(function(t){this.l(t.takeRecords())},this))},t.prototype.K=function(){var t=this;if(!this.s){this.s=!0;var e=function(){t.s=!1,t.m||(t.m=t.b(a)),t.c(a.childNodes)};window.HTMLImports?window.HTMLImports.whenReady(e):e()}},t.prototype.I=function(t){this.f=t},t.prototype.b=function(t){return null!=t.__$CE_observer||(t.__$CE_observer=new MutationObserver(this.l.bind(this)),t.__$CE_observer.observe(t,{childList:!0,subtree:!0}),this.enableFlush&&this.o.add(t.__$CE_observer)),t.__$CE_observer},t.prototype.J=function(t){null!=t.__$CE_observer&&(t.__$CE_observer.disconnect(),this.enableFlush&&this.o.delete(t.__$CE_observer),t.__$CE_observer=null)},t.prototype.l=function(t){for(var e=0;e<t.length;e++){var o=t[e];if("childList"===o.type){var n=o.removedNodes;this.c(o.addedNodes),this.H(n)}}},t.prototype.c=function(t,e){e=e||new Set;for(var o=0;o<t.length;o++){var n=t[o];if(n.nodeType===Node.ELEMENT_NODE)for(this.J(n),n=a.createTreeWalker(n,NodeFilter.SHOW_ELEMENT,null,!1);this.G(n.currentNode,e),n.nextNode(););}},t.prototype.G=function(t,e){if(!e.has(t)){e.add(t);var o=this.a.get(t.localName);if(o){var n;if(t.__$CE_upgraded||this.u(t,o,!0),n=t.__$CE_upgraded&&!t.__$CE_attached)t:{n=t;do{if(n.__$CE_attached||n.nodeType===Node.DOCUMENT_NODE){n=!0;break t}n=n.parentNode||n.nodeType===Node.DOCUMENT_FRAGMENT_NODE&&n.host}while(n);n=!1}n&&(t.__$CE_attached=!0,o.v&&o.v.call(t))}t.shadowRoot&&this.c(t.shadowRoot.childNodes,e),"LINK"===t.tagName&&t.rel&&-1!==t.rel.toLowerCase().split(" ").indexOf("import")&&this.B(t,e)}},t.prototype.B=function(e,t){var o=e.import;if(o)t.has(o)||(t.add(o),o.__$CE_observer||this.b(o),this.c(o.childNodes,t));else if(t=e.href,!this.F.has(t)){this.F.add(t);var n=this;e.addEventListener("load",function t(){e.removeEventListener("load",t),e.import.__$CE_observer||n.b(e.import),n.c(e.import.childNodes)})}},t.prototype.H=function(t){for(var e=0;e<t.length;e++){var o=t[e];if(o.nodeType===Node.ELEMENT_NODE){this.b(o),o=a.createTreeWalker(o,NodeFilter.SHOW_ELEMENT,null,!1);do{var n=o.currentNode;if(n.__$CE_upgraded&&n.__$CE_attached){n.__$CE_attached=!1;var i=this.a.get(n.localName);i&&i.w&&i.w.call(n)}}while(o.nextNode())}}},t.prototype.u=function(t,e,o){if(t.__proto__=e.constructor.prototype,o&&(this.I(t),new e.constructor,t.__$CE_upgraded=!0,console.assert(!this.f)),o=e.A,(e=e.i)&&0<o.length){this.C.observe(t,{attributes:!0,attributeOldValue:!0,attributeFilter:o});for(var n=0;n<o.length;n++){var i=o[n];if(t.hasAttribute(i)){var r=t.getAttribute(i);e.call(t,i,null,r,null)}}}},t.prototype.D=function(t){for(var e=0;e<t.length;e++){var o=t[e];if("attributes"===o.type){var n=o.target,i=this.a.get(n.localName),r=o.attributeName,a=o.oldValue,s=n.getAttribute(r);s!==a&&i.i.call(n,r,a,s,o.attributeNamespace)}}},(window.CustomElementRegistry=t).prototype.define=t.prototype.L,t.prototype.get=t.prototype.get,t.prototype.whenDefined=t.prototype.M,t.prototype.flush=t.prototype.g,t.prototype.polyfilled=!0,t.prototype._observeRoot=t.prototype.b,t.prototype._addImport=t.prototype.B;var s=e.HTMLElement;t.prototype.nativeHTMLElement=s,e.HTMLElement=function(){var t=r();if(t.f){var e=t.f;return t.f=null,e}if(this.constructor)return t=t.j.get(this.constructor),o(a,t,void 0,!1);throw Error("Unknown constructor. Did you call customElements.define()?")},e.HTMLElement.prototype=s.prototype;var c=a.createElement;a.createElement=function(t,e){return o(a,t,e,!0)};var u=a.createElementNS;a.createElementNS=function(t,e){return"http://www.w3.org/1999/xhtml"===t?a.createElement(e):u.call(a,t,e)};var h=Element.prototype.attachShadow;h&&Object.defineProperty(Element.prototype,"attachShadow",{value:function(t){return t=h.call(this,t),r().b(t),t}});var d=a.importNode;a.importNode=function(t,e){return t=d.call(a,t,e),r().c(t.nodeType===Node.ELEMENT_NODE?[t]:t.childNodes),t};var p=Element.prototype.setAttribute;Element.prototype.setAttribute=function(t,e){n(this,t,e,p)};var f=Element.prototype.removeAttribute;Element.prototype.removeAttribute=function(t){n(this,t,null,f)},Object.defineProperty(window,"customElements",{value:new t,configurable:!0,enumerable:!0}),window.CustomElements={takeRecords:function(){r().g&&r().g()}}}}();var GcComponent=function(t){function e(){_classCallCheck(this,e);var t=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t.id=t.id||function(){function t(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return"c"+t()+t()+t()+t()+t()+t()+t()+t()}(),t._cache={events:{}},t.useNativeShadow=window.customElements.toString().includes("CustomElementRegistry"),t.useNativeShadow?t.shadowSelector=":host":t.shadowSelector="#"+t.id,t}return _inherits(e,HTMLElement),_createClass(e,[{key:"$",value:function(t){return this.querySelector(t)}},{key:"$$",value:function(t){return this.querySelectorAll(t)}},{key:"fireEvent",value:function(t,e){var o=!(2<arguments.length&&void 0!==arguments[2])||arguments[2],n=JSON.stringify(arguments);if(!(n in this._cache.events)){var i={bubbles:o};i.detail=e,this._cache.events[n]=new CustomEvent(t,i)}this.dispatchEvent(this._cache.events[n])}},{key:"makeShadow",value:function(){var e=this;0<arguments.length&&void 0!==arguments[0]&&arguments[0];this.useNativeShadow?this.attachShadow({mode:"open"}):this.shadowRoot=this,this.shadowRoot.$=function(t){return e.shadowRoot.querySelector(t)},this.shadowRoot.$$=function(t){return new CustomNodeList(e.shadowRoot.querySelectorAll(t))}}},{key:"getNativeElement",value:function(){return this}},{key:"getOuterSize",value:function(){return this.getElementOuterSize(this.getNativeElement())}},{key:"getInnerSize",value:function(){return this.getElementInnerSize(this.getNativeElement())}},{key:"getElementOuterSize",value:function(e){try{var t=getComputedStyle(e),o=void 0,n=void 0;return"BODY"===e.tagName?(o=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,n=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth):(o=e.offsetHeight,n=e.offsetWidth),o+=parseFloat(t.marginTop)+parseFloat(t.marginBottom),{w:n+=parseFloat(t.marginLeft)+parseFloat(t.marginRight),h:o}}catch(t){return{w:e.offsetWidth,h:e.offsetHeight}}}},{key:"getElementInnerSize",value:function(e){try{var t=getComputedStyle(e),o=void 0,n=void 0;return"BODY"===e.tagName?(o=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,n=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,o-=parseFloat(t.marginTop)+parseFloat(t.marginBottom),n-=parseFloat(t.marginLeft)+parseFloat(t.marginRight)):(o=e.offsetHeight,n=e.offsetWidth),o-=parseFloat(t.paddingTop)+parseFloat(t.paddingBottom),{w:n-=parseFloat(t.paddingLeft)+parseFloat(t.paddingRight),h:o}}catch(t){return{w:e.offsetWidth,h:e.offsetHeight}}}}]),e}(),GcPdfButton=function(t){function o(){_classCallCheck(this,o);var t=_possibleConstructorReturn(this,(o.__proto__||Object.getPrototypeOf(o)).call(this)),e=t.shadowSelector+" a { margin-left: 5px; margin-right: 5px; text-decoraton: none; color: #ffffff; fill: #ffffff; stroke: #ffffff; width: 25px; height: 25px; display: inline-block; }";return t.text||(t.text=t.textContent),t.makeShadow(),t.shadowRoot.innerHTML="<style>"+e+'</style>\n            <a href="#" class="gc-pdfbutton" title="'+t.title+'">'+t.text+"</a>",t.elementA=t.shadowRoot.$("a"),t.elementA.onclick=function(){return!1},t}return _inherits(o,GcComponent),_createClass(o,[{key:"attributeChangedCallback",value:function(t,e,o){switch(t){case"title":this.elementA.title=o;break;case"icon":this.update()}}},{key:"icon",get:function(){return this.getAttribute("icon")||""},set:function(t){t?this.setAttribute("icon",t):this.removeAttribute("icon")}}],[{key:"observedAttributes",get:function(){return["title","icon"]}}]),_createClass(o,[{key:"update",value:function(){if(this.icon)switch(this.icon){case"svg:rotate":this.elementA.innerHTML='<svg viewBox="0 0 24 24" preserveAspectRatio="xMidYMid meet" focusable="false" style="pointer-events: none; display: block; width: 100%; height: 100%;">\n<g>\n<path d="M15.55 5.55L11 1v3.07C7.06 4.56 4 7.92 4 12s3.05 7.44 7 7.93v-2.02c-2.84-.48-5-2.94-5-5.91s2.16-5.43 5-5.91V10l4.55-4.45zM19.93 11c-.17-1.39-.72-2.73-1.62-3.89l-1.42 1.42c.54.75.88 1.6 1.02 2.47h2.02zM13 17.9v2.02c1.39-.17 2.74-.71 3.9-1.61l-1.44-1.44c-.75.54-1.59.89-2.46 1.03zm3.89-2.42l1.42 1.41c.9-1.16 1.45-2.5 1.62-3.89h-2.02c-.14.87-.48 1.72-1.02 2.48z"></path>\n</g></svg>';break;case"svg:download":this.elementA.innerHTML='<svg viewBox="0 0 24 24" preserveAspectRatio="xMidYMid meet" focusable="false" style="pointer-events: none; display: block; width: 100%; height: 100%;">\n<g><path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"></path></g></svg>';break;case"svg:openfile":this.elementA.innerHTML='<svg viewBox="0 0 24 24" preserveAspectRatio="xMidYMid meet" focusable="false" style="pointer-events: none; display: block; width: 100%; height: 100%;">\n<g>\n<path d="M19.54369321107791,9.63552147172598 c-0.17532659320111435,-0.21860341051025028 -0.4409056942947855,-0.34621453847308664 -0.7212802884855972,-0.34621453847308664 H17.897694604021034 c0,-0.5108143991787741 -0.4139039193925041,-0.9247183185712783 -0.9247183185712783,-0.9247183185712783 H16.048257966878477 V7.4398702961103425 C16.048257966878477,6.929055896931565 15.634354047485974,6.5151519775390625 15.123539648307197,6.5151519775390625 h-11.096619822855338 C3.5161054262730858,6.5151519775390625 3.102201506880583,6.929055896931565 3.102201506880583,7.4398702961103425 v11.096619822855338 C3.102201506880583,19.047304518144458 3.5161054262730858,19.461208437536953 4.026919825451859,19.461208437536953 h1.8494366371425563 h9.247183185712782 h1.8494366371425563 c0.43350794774621526,0 0.809313472413583,-0.3010882845268084 0.9021551915981392,-0.7242393871050251 l1.8494366371425563,-8.322464867141504 C19.785969410543586,10.140787560993331 19.71938969160645,9.854124882236235 19.54369321107791,9.63552147172598 zM4.026919825451859,7.4398702961103425 h11.096619822855338 V8.364588614681622 H14.198821329735921 c-0.5108143991787741,0 -0.9247183185712783,0.4139039193925041 -0.9247183185712783,0.9247183185712783 h-5.548309911427669 c-0.43350794774621526,0 -0.8085736977587256,0.3010882845268084 -0.9025250789255677,0.7242393871050251 c0,0 -1.8708901021334103,8.456364079670625 -1.8708901021334103,8.522943798607757 H4.026919825451859 V7.4398702961103425 L4.026919825451859,7.4398702961103425 z" id="svg_2"></path>\n</g></svg>'}}}]),o}();customElements.define("gc-pdfbutton",GcPdfButton);var GcPdfViewerToolbar=function(t){function o(){_classCallCheck(this,o);var t=_possibleConstructorReturn(this,(o.__proto__||Object.getPrototypeOf(o)).call(this)),e=":host .toolbar{width:100%;height: 45px; line-height: 45px; overflow:hidden; background: #323639; color: white; position:relative;} \n                        :host .buttons {float:right;margin-top: 8px;}\n                          :host .title {width: 38%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; display: inline-block;}\n                          :host .pageselector { position: absolute; left: 49%; } \n                          :host span.spacer-left {width: 20px;height:1px;float:left;} :host span.spacer-right {width: 20px;height:1px;float:right;}";return e=e.replace(":host",t.shadowSelector),t.makeShadow(),t.shadowRoot.innerHTML="<style>"+e+'</style>\n            <div class="toolbar">\n                    <span class="spacer-left"></span>\n                    <span class="title">                        \n                    </span>\n                    <span class="spacer-right"></span>\n                    <span class="pageselector">\n                        <span class="currentpage">0</span><span>/</span><span class="pagescount">1</span>\n                    </span>                    \n                    <span class="buttons">\n                        <gc-pdfbutton class="rotate-doc" icon="svg:rotate" text="Rotate" title="Rotate PDF"></gc-pdfbutton>\n                        <gc-pdfbutton class="download-doc" icon="svg:download" text="Download" title="Download PDF"></gc-pdfbutton>\n                        <gc-pdfbutton class="open-doc" icon="svg:openfile" title="Open PDF"></gc-pdfbutton>\n                    </span>\n                \n            </div>',t.theStyle=t.shadowRoot.$("style"),t.theTitle=t.shadowRoot.$(".title"),t.theTitle.innerHTML="",t.theToolbar=t.shadowRoot.$(".toolbar"),t.elementCurrentPage=t.shadowRoot.$(".currentpage"),t.elementPagesCount=t.shadowRoot.$(".pagescount"),t.elementRotateDoc=t.shadowRoot.$(".rotate-doc"),t.elementDownloadDoc=t.shadowRoot.$(".download-doc"),t.elementOpenDoc=t.shadowRoot.$(".open-doc"),t.elementRotateDoc.addEventListener("click",function(){t.fireEvent("action","rotate")}),t.elementDownloadDoc.addEventListener("click",function(){t.fireEvent("action","download")}),t.elementOpenDoc.addEventListener("click",function(){t.fireEvent("action","open")}),t}return _inherits(o,GcComponent),_createClass(o,[{key:"attributeChangedCallback",value:function(t,e,o){switch(t){case"currentpage":this.elementCurrentPage.innerHTML=o;case"pagescount":this.elementPagesCount.innerHTML=o;case"title":this.theTitle.innerHTML=o;break;case"width":this.theToolbar.style.width=o}}},{key:"getNativeElement",value:function(){return this.theToolbar}},{key:"currentpage",get:function(){if(!this.getAttribute("currentpage"))return 1},set:function(t){this.setAttribute("currentpage",t)}},{key:"height",get:function(){return this.getAttribute("height")},set:function(t){t?this.setAttribute("height",t):this.removeAttribute("height")}},{key:"pagescount",get:function(){if(!this.getAttribute("pagescount"))return 0},set:function(t){this.setAttribute("pagescount",t)}},{key:"title",get:function(){return this.getAttribute("title")},set:function(t){t?this.setAttribute("title",t):this.removeAttribute("title")}},{key:"width",get:function(){return this.getAttribute("width")},set:function(t){t?this.setAttribute("width",t):this.removeAttribute("width")}}],[{key:"observedAttributes",get:function(){return["currentpage","pagescount","title","width"]}}]),o}();customElements.define("gc-pdftoolbar",GcPdfViewerToolbar);var GcPdfViewer=function(t){function o(){_classCallCheck(this,o);var e=_possibleConstructorReturn(this,(o.__proto__||Object.getPrototypeOf(o)).call(this));e.pdfjsLib=window["pdfjs-dist/build/pdf"];var t="\n                    :host .container { position: relative; width:"+(e.getAttribute("width")||"100%")+"; height:"+(e.getAttribute("height")||"100%")+"; overflow: hidden; }\n                    :host .scrollview{ overflow:auto; } \n                    :host canvas { } \n                    :host .zoom-buttons { position: absolute; bottom: 20px; right: 20px; width: 55px; height: 150px; display: none; } \n                    :host .zoom-buttons a { width: 50px; height: 50px; line-height: 50px; text-align: center; display: inline-block; } ";return t=t.replace(":host",e.shadowSelector),e.makeShadow(),e.shadowRoot.innerHTML="<style>"+t+'</style>\n                  <div class="container">\n                    <gc-pdftoolbar></gc-pdftoolbar>\n                    <div class="scrollview">\n                        <canvas></canvas>\n                    </div>\n                    <div class="zoom-buttons">\n                        <a class="zoom-fit" text="Fit" is="gc-link-button" />\n                        <a class="zoom-in" text="+" is="gc-link-button" />\n                        <a class="zoom-out" text="-" is="gc-link-button" />    \n                    </div>\n                  </div>',e.theCanvas=e.shadowRoot.$("canvas"),e.elementContainer=e.shadowRoot.$(".container"),e.elementScrollView=e.shadowRoot.$(".scrollview"),e.elementZoomButtons=e.shadowRoot.$(".zoom-buttons"),"hidden"!==e.zoomButtons&&(e.elementZoomButtons.style.display="block",e.shadowRoot.$(".zoom-fit").addEventListener("click",function(){return e.tool_zoomFit}),e.shadowRoot.$(".zoom-in").addEventListener("click",function(){return e.tool_zoomIn}),e.shadowRoot.$(".zoom-out").addEventListener("click",function(){return e.tool_zoomOut})),e.elementToolbar=e.shadowRoot.$("gc-pdftoolbar"),e.elementToolbar.addEventListener("action",function(t){return e["tool_"+(t.detail||"unknown")]()}),window.GrabToPan&&(e.elementScrollView.style.cursor="pointer",e.grabToPan=new window.GrabToPan({element:e.elementScrollView}),e.grabToPan.activate()),window.addEventListener("resize",function(t){e.onResize()}),e}return _inherits(o,GcComponent),_createClass(o,[{key:"attributeChangedCallback",value:function(t,e,o){switch(t){case"file":this.loadFromUrl(o);break;case"pagenum":this.loadPage(1*o);break;case"width":case"height":this.update();break;case"zoom-buttons":this.elementZoomButtons.style.display="hidden"===o?"none":"block"}}},{key:"getNativeElement",value:function(){return this.elementContainer}},{key:"pagesCache",get:function(){return this.pagesCache||(this.pagesCache=new GcPagesCache),this.pagesCache}},{key:"width",get:function(){return this.getAttribute("width")},set:function(t){t?this.setAttribute("width",t):this.removeAttribute("width")}},{key:"height",get:function(){return this.getAttribute("height")},set:function(t){t?this.setAttribute("height",t):this.removeAttribute("height")}},{key:"file",get:function(){return this.getAttribute("file")},set:function(t){t?this.setAttribute("file",t):this.removeAttribute("file")}},{key:"pagenum",get:function(){var t=this.getAttribute("pagenum");return t||1},set:function(t){this.setAttribute("pagenum",t)}},{key:"zoomButtons",get:function(){var t=this.getAttribute("zoom-buttons");return t||"visible"},set:function(t){this.setAttribute("zoom-buttons",t)}}],[{key:"observedAttributes",get:function(){return["file","pagenum","width","height","zoomButtons"]}}]),_createClass(o,[{key:"load",value:function(t){console.log("TODO: implement caching and other staff for load(pdfDocument)");try{this.pdfDocument=t,this.updateToolbar(),this.loadPage(this.pagenum),this.fireEvent("documentload"),this.update()}catch(t){this._loadingLock=!1,console.log("Error: "+t)}}},{key:"close",value:function(){console.log("todo: implement close");var t=this.pdfLoadingTask.destroy();return this.pdfLoadingTask=null,t}},{key:"open",value:function(t,e){var n=this;if(this.pdfLoadingTask)return this.close().then(function(){return n.open(t,e)});var o=Object.create(null);"string"==typeof t?(this.setTitleUsingUrl(t),o.url=t):t&&"byteLength"in t?o.data=t:t.url&&t.originalUrl&&(this.setTitleUsingUrl(t.originalUrl),o.url=t.url);var i=(0,this.pdfjsLib.getDocument)(o);return(this.pdfLoadingTask=i).onPassword=function(t,e){n.passwordPrompt.setUpdateCallback(t,e),n.passwordPrompt.open()},i.onProgress=function(t){var e=t.loaded,o=t.total;n.progress(e/o)},i.then(function(t){console.log("pdfDocument ready! "+t),n.load(t)},function(t){i===n.pdfLoadingTask&&console.error(t)})}},{key:"update",value:function(){this.height||(console.log(this.getElementInnerSize(this.parentNode)),this.elementContainer.style.height=this.getElementInnerSize(this.parentNode).h+"px");var t=this.getElementOuterSize(this.elementContainer).h-this.elementToolbar.getOuterSize().h;console.log("scrollViewHeight:::::::"+t+" container h:"+this.getElementOuterSize(this.elementContainer).h+", toolbar h: "+this.elementToolbar.getOuterSize().h),this.elementScrollView.style.height=t+"px"}},{key:"loadPage",value:function(i){var r=this;console.log("loadPage "+i),this.pdfDocument.getPage(i).then(function(t){r.updateToolbar(),r.currentScaleValue;var e=t.getViewport(1),o=r.theCanvas.getContext("2d");r.theCanvas.height=e.height,r.theCanvas.width=e.width;var n={canvasContext:o,viewport:e};t.render(n).then(function(){console.log("Page rendered"),r._loadingLock=!1,r.fireEvent("pagerendered",i)})})}},{key:"progress",value:function(t){console.log("Load progress: "+t+"%")}},{key:"webViewerUpdateViewarea",value:function(t){var e=t.location,o=PDFViewerApplication.store;o&&PDFViewerApplication.isInitialViewSet&&o.setMultiple({page:e.pageNumber,zoom:e.scale,scrollLeft:e.left,scrollTop:e.top,rotation:e.rotation}).catch(function(){});var n=PDFViewerApplication.pdfLinkService.getAnchorUrl(e.pdfOpenParams);PDFViewerApplication.appConfig.toolbar.viewBookmark.href=n,PDFViewerApplication.appConfig.secondaryToolbar.viewBookmarkButton.href=n;var i=PDFViewerApplication.pdfViewer.getPageView(PDFViewerApplication.page-1).renderingState!==_pdf_rendering_queue.RenderingStates.FINISHED;PDFViewerApplication.toolbar.updateLoadingIndicatorState(i)}},{key:"onResize",value:function(){if(console.log("onResize"),this.pdfDocument){var t=this.currentScaleValue;"auto"!==t&&"page-fit"!==t&&"page-width"!==t||(this.currentScaleValue=t),this.update()}}},{key:"updateLocation",value:function(t){var e=this._currentScale,o=this._currentScaleValue,n=parseFloat(o)===e?Math.round(1e4*e)/100:o,i=t.id,r="#page="+i;r+="&zoom="+n;var a=this._pages[i-1],s=this.container,l=a.getPagePoint(s.scrollLeft-t.x,s.scrollTop-t.y),c=Math.round(l[0]),u=Math.round(l[1]);r+=","+c+","+u,this._location={pageNumber:i,scale:n,top:u,left:c,rotation:this._pagesRotation,pdfOpenParams:r}}},{key:"tool_rotate",value:function(){console.log("todo: rotate")}},{key:"tool_zoomFit",value:function(){console.log("tool_zoomFit TODO.");for(var t=this.pdfViewer.currentScale;t=(t*DEFAULT_SCALE_DELTA).toFixed(2),t=Math.ceil(10*t)/10,t=Math.min(_ui_utils.MAX_SCALE,t),0<--ticks&&t<_ui_utils.MAX_SCALE;);this.currentScaleValue=t}},{key:"tool_zoomIn",value:function(t){console.log("tool_zoomIn TODO.");for(var e=this.pdfViewer.currentScale;e=(e*DEFAULT_SCALE_DELTA).toFixed(2),e=Math.ceil(10*e)/10,e=Math.min(_ui_utils.MAX_SCALE,e),0<--t&&e<_ui_utils.MAX_SCALE;);this.pdfViewer.currentScaleValue=e}},{key:"tool_zoomOut",value:function(t){console.log("tool_zoomOut TODO.");for(var e=this.pdfViewer.currentScale;e=(e/DEFAULT_SCALE_DELTA).toFixed(2),e=Math.floor(10*e)/10,e=Math.max(_ui_utils.MIN_SCALE,e),0<--t&&e>_ui_utils.MIN_SCALE;);this.pdfViewer.currentScaleValue=e}},{key:"tool_download",value:function(){var n=this;console.log("tool_download");this.pdfDocument.getData().then(function(t){var e=new Blob([t],{type:"application/pdf"});console.log("blob ready to download "+e);var o=""+n.elementToolbar.title;o.endsWith(".pdf")||(o+=".pdf"),function(t,e){var o=document.createElement("a");if(!o.click)throw new Error('DownloadManager: "a.click()" is not supported.');o.style="display: none",o.href=t,o.target="_parent","download"in o&&(o.download=e),(document.body||document.documentElement).appendChild(o),o.click(),o.remove()}(window.URL.createObjectURL(e),o)})}},{key:"tool_open",value:function(){var i=this;console.log("tool_open");var t="gcCommonOpenfileInput"+this.id;if(!document.getElementById(t)){var e=document.createElement("input");e.id=t,e.className="fileInput",e.setAttribute("type","file"),e.style="position: absolute;left:-200px;top:-200px;width:1px;height:1px;",document.body.appendChild(e),window.File&&window.FileReader&&window.FileList&&window.Blob&&(e.value=null),e.addEventListener("change",function(t){var e=t.target.files;if(e&&0!==e.length){console.log("got file:"+t.target);var o=new FileReader;o.onload=function(t){var e=t.target.result;i.open(new Uint8Array(e))};var n=e[0];console.log("file: "+n+" file.name: "+n.name),o.readAsArrayBuffer(n)}})}document.getElementById(t).click()}},{key:"loadFromUrl",value:function(t){var e=this;(this.pdfDocument=null,this.pdfjsLib)?this._loadingLock?console.log("already laoading.."):(this._loadingLock=!0,this.pdfUrl=t,this.pdfjsLib.getDocument(this.pdfUrl).promise.then(function(t){try{e.pdfDocument=t,e.updateToolbar(),e.loadPage(e.pagenum),e.fireEvent("documentload"),e.update()}catch(t){e._loadingLock=!1,console.log("Error: "+t)}},function(t){e._loadingLock=!1,console.error("PDF loading error: "+t)})):console.error("pdfjsLib not found")}},{key:"updateToolbar",value:function(){var n=this;console.log("---\x3eupdateToolbar "+this.elementToolbar),this.elementToolbar.width=this.elementScrollView.style.width,this.pdfDocument.getMetadata().then(function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=t.info,o=void 0===e?{Title:Title,Author:Author,Subject:Subject,Keywords:Keywords,Creator:Creator,Producer:Producer,PDFFormatVersion:PDFFormatVersion}:e;t.metadata,t.contentDispositionFilename;n.elementToolbar.title=o.Title||n.pdfUrl}).catch(function(t){console.error("getMetadata error: "+t)}),this.elementToolbar.currentpage=this.pagenum,this.elementToolbar.pagescount=this.pdfDocument.numPages}}]),o}();customElements.define("gc-pdfviewer",GcPdfViewer);