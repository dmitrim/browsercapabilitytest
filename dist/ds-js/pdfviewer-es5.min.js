"use strict";var _createClass=function(){function n(t,e){for(var o=0;o<e.length;o++){var n=e[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,o){return e&&n(t.prototype,e),o&&n(t,o),t}}(),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}!function(){function t(){this.a=new Map,this.j=new Map,this.h=new Map,this.o=new Set,this.C=new MutationObserver(this.D.bind(this)),this.f=null,this.F=new Set,this.enableFlush=!0,this.s=!1,this.m=null}function i(){return e.customElements}function l(t){if(!/^[a-z][.0-9_a-z]*-[\-.0-9_a-z]*$/.test(t)||-1!==r.indexOf(t))return Error("The element name '"+t+"' is not valid.")}function o(t,e,o,n){var r=i();return t=o?c.call(t,e,o):c.call(t,e),(e=r.a.get(e.toLowerCase()))&&r.u(t,e,n),r.b(t),t}function n(t,e,o,n){e=e.toLowerCase();var r=t.getAttribute(e);n.call(t,e,o),1==t.__$CE_upgraded&&(o=(n=i().a.get(t.localName)).A,(n=n.i)&&0<=o.indexOf(e)&&((o=t.getAttribute(e))!==r&&n.call(t,e,r,o,null)))}var s=document,e=window;if(!i()||(i().g=function(){},i().forcePolyfill)){var r="annotation-xml color-profile font-face font-face-src font-face-uri font-face-format font-face-name missing-glyph".split(" ");t.prototype.L=function(t,e){function o(t){var e=r[t];if(void 0!==e&&"function"!=typeof e)throw Error(n+" '"+t+"' is not a Function");return e}if("function"!=typeof e)throw new TypeError("constructor must be a Constructor");if(i=l(t))throw i;if(this.a.has(t))throw Error("An element with name '"+t+"' is already defined");if(this.j.has(e))throw Error("Definition failed for '"+t+"': The constructor is already used.");var n=t,r=e.prototype;if("object"!==(void 0===r?"undefined":_typeof(r)))throw new TypeError("Definition failed for '"+t+"': constructor.prototype must be an object");var i=o("connectedCallback"),s=o("disconnectedCallback"),a=o("attributeChangedCallback");this.a.set(n,{name:t,localName:n,constructor:e,v:i,w:s,i:a,A:a&&e.observedAttributes||[]}),this.j.set(e,n),this.K(),(t=this.h.get(n))&&(t.resolve(void 0),this.h.delete(n))},t.prototype.get=function(t){return(t=this.a.get(t))?t.constructor:void 0},t.prototype.M=function(t){if(n=l(t))return Promise.reject(n);if(this.a.has(t))return Promise.resolve();if(n=this.h.get(t))return n.N;var e,o=new Promise(function(t){e=t}),n={N:o,resolve:e};return this.h.set(t,n),o},t.prototype.g=function(){this.enableFlush&&(this.l(this.m.takeRecords()),this.D(this.C.takeRecords()),this.o.forEach(function(t){this.l(t.takeRecords())},this))},t.prototype.K=function(){var t=this;if(!this.s){this.s=!0;var e=function(){t.s=!1,t.m||(t.m=t.b(s)),t.c(s.childNodes)};window.HTMLImports?window.HTMLImports.whenReady(e):e()}},t.prototype.I=function(t){this.f=t},t.prototype.b=function(t){return null!=t.__$CE_observer||(t.__$CE_observer=new MutationObserver(this.l.bind(this)),t.__$CE_observer.observe(t,{childList:!0,subtree:!0}),this.enableFlush&&this.o.add(t.__$CE_observer)),t.__$CE_observer},t.prototype.J=function(t){null!=t.__$CE_observer&&(t.__$CE_observer.disconnect(),this.enableFlush&&this.o.delete(t.__$CE_observer),t.__$CE_observer=null)},t.prototype.l=function(t){for(var e=0;e<t.length;e++){var o=t[e];if("childList"===o.type){var n=o.removedNodes;this.c(o.addedNodes),this.H(n)}}},t.prototype.c=function(t,e){e=e||new Set;for(var o=0;o<t.length;o++){var n=t[o];if(n.nodeType===Node.ELEMENT_NODE)for(this.J(n),n=s.createTreeWalker(n,NodeFilter.SHOW_ELEMENT,null,!1);this.G(n.currentNode,e),n.nextNode(););}},t.prototype.G=function(t,e){if(!e.has(t)){e.add(t);var o=this.a.get(t.localName);if(o){var n;if(t.__$CE_upgraded||this.u(t,o,!0),n=t.__$CE_upgraded&&!t.__$CE_attached)t:{n=t;do{if(n.__$CE_attached||n.nodeType===Node.DOCUMENT_NODE){n=!0;break t}n=n.parentNode||n.nodeType===Node.DOCUMENT_FRAGMENT_NODE&&n.host}while(n);n=!1}n&&(t.__$CE_attached=!0,o.v&&o.v.call(t))}t.shadowRoot&&this.c(t.shadowRoot.childNodes,e),"LINK"===t.tagName&&t.rel&&-1!==t.rel.toLowerCase().split(" ").indexOf("import")&&this.B(t,e)}},t.prototype.B=function(e,t){var o=e.import;if(o)t.has(o)||(t.add(o),o.__$CE_observer||this.b(o),this.c(o.childNodes,t));else if(t=e.href,!this.F.has(t)){this.F.add(t);var n=this;e.addEventListener("load",function t(){e.removeEventListener("load",t),e.import.__$CE_observer||n.b(e.import),n.c(e.import.childNodes)})}},t.prototype.H=function(t){for(var e=0;e<t.length;e++){var o=t[e];if(o.nodeType===Node.ELEMENT_NODE){this.b(o),o=s.createTreeWalker(o,NodeFilter.SHOW_ELEMENT,null,!1);do{var n=o.currentNode;if(n.__$CE_upgraded&&n.__$CE_attached){n.__$CE_attached=!1;var r=this.a.get(n.localName);r&&r.w&&r.w.call(n)}}while(o.nextNode())}}},t.prototype.u=function(t,e,o){if(t.__proto__=e.constructor.prototype,o&&(this.I(t),new e.constructor,t.__$CE_upgraded=!0,console.assert(!this.f)),o=e.A,(e=e.i)&&0<o.length){this.C.observe(t,{attributes:!0,attributeOldValue:!0,attributeFilter:o});for(var n=0;n<o.length;n++){var r=o[n];if(t.hasAttribute(r)){var i=t.getAttribute(r);e.call(t,r,null,i,null)}}}},t.prototype.D=function(t){for(var e=0;e<t.length;e++){var o=t[e];if("attributes"===o.type){var n=o.target,r=this.a.get(n.localName),i=o.attributeName,s=o.oldValue,a=n.getAttribute(i);a!==s&&r.i.call(n,i,s,a,o.attributeNamespace)}}},(window.CustomElementRegistry=t).prototype.define=t.prototype.L,t.prototype.get=t.prototype.get,t.prototype.whenDefined=t.prototype.M,t.prototype.flush=t.prototype.g,t.prototype.polyfilled=!0,t.prototype._observeRoot=t.prototype.b,t.prototype._addImport=t.prototype.B;var a=e.HTMLElement;t.prototype.nativeHTMLElement=a,e.HTMLElement=function(){var t=i();if(t.f){var e=t.f;return t.f=null,e}if(this.constructor)return t=t.j.get(this.constructor),o(s,t,void 0,!1);throw Error("Unknown constructor. Did you call customElements.define()?")},e.HTMLElement.prototype=a.prototype;var c=s.createElement;s.createElement=function(t,e){return o(s,t,e,!0)};var h=s.createElementNS;s.createElementNS=function(t,e){return"http://www.w3.org/1999/xhtml"===t?s.createElement(e):h.call(s,t,e)};var u=Element.prototype.attachShadow;u&&Object.defineProperty(Element.prototype,"attachShadow",{value:function(t){return t=u.call(this,t),i().b(t),t}});var d=s.importNode;s.importNode=function(t,e){return t=d.call(s,t,e),i().c(t.nodeType===Node.ELEMENT_NODE?[t]:t.childNodes),t};var f=Element.prototype.setAttribute;Element.prototype.setAttribute=function(t,e){n(this,t,e,f)};var p=Element.prototype.removeAttribute;Element.prototype.removeAttribute=function(t){n(this,t,null,p)},Object.defineProperty(window,"customElements",{value:new t,configurable:!0,enumerable:!0}),window.CustomElements={takeRecords:function(){i().g&&i().g()}}}}();var GcComponent=function(t){function e(){_classCallCheck(this,e);var t=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t.id=t.id||t.guid(),t._cache={events:{}},t.useNativeShadow=-1!=window.customElements.toString().indexOf("CustomElementRegistry"),t.useNativeShadow?(console.log("Good browser, use Shadow DOM"),t.shadowSelector=":host"):(console.log("Not good browser, don't use Shadow DOM"),t.shadowSelector="#"+t.id),t}return _inherits(e,HTMLElement),_createClass(e,[{key:"$",value:function(t){return this.querySelector(t)}},{key:"$$",value:function(t){return this.querySelectorAll(t)}},{key:"fireEvent",value:function(t,e){var o=!(2<arguments.length&&void 0!==arguments[2])||arguments[2],n=JSON.stringify(arguments);if(!(n in this._cache.events)){var r={bubbles:o};e instanceof Object&&(r.detail=e),this._cache.events[n]=new CustomEvent(t,r)}this.dispatchEvent(this._cache.events[n])}},{key:"loadScript",value:function(t,e){console.log("Loading "+t);var o=document.getElementsByTagName("head")[0],n=document.createElement("script");n.type="text/javascript",n.src=t,n.onload=e,o.appendChild(n)}},{key:"guid",value:function(){function t(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return"c"+t()+t()+t()+t()+t()+t()+t()+t()}},{key:"makeShadow",value:function(){var e=this;0<arguments.length&&void 0!==arguments[0]&&arguments[0];this.useNativeShadow?this.attachShadow({mode:"open"}):this.shadowRoot=this,this.shadowRoot.$=function(t){return e.shadowRoot.querySelector(t)},this.shadowRoot.$$=function(t){return new CustomNodeList(e.shadowRoot.querySelectorAll(t))}}},{key:"is",get:function(){return this.localName}}]),e}();!function(){var o;["webkitM","mozM","msM","oM","m"].some(function(t){var e=t+"atches";return e in document.documentElement&&(o=e),(e+="Selector")in document.documentElement&&(o=e),o});var s=!document.documentMode||9<document.documentMode,t=window.chrome,a=t&&(t.webstore||t.app),l=/Apple/.test(navigator.vendor)&&/Version\/([6-9]\d*|[1-5]\d+)/.test(navigator.userAgent);function n(t){this.element=t.element,this.document=t.element.ownerDocument,"function"==typeof t.ignoreTarget&&(this.ignoreTarget=t.ignoreTarget),this.onActiveChanged=t.onActiveChanged,this.activate=this.activate.bind(this),this.deactivate=this.deactivate.bind(this),this.toggle=this.toggle.bind(this),this._onmousedown=this._onmousedown.bind(this),this._onmousemove=this._onmousemove.bind(this),this._endPan=this._endPan.bind(this),(this.overlay=document.createElement("div")).className="grab-to-pan-grabbing"}n.prototype={CSS_CLASS_GRAB:"grab-to-pan-grab",activate:function(){this.active||(this.active=!0,this.element.addEventListener("mousedown",this._onmousedown,!0),this.element.classList.add(this.CSS_CLASS_GRAB),this.onActiveChanged&&this.onActiveChanged(!0))},deactivate:function(){this.active&&(this.active=!1,this.element.removeEventListener("mousedown",this._onmousedown,!0),this._endPan(),this.element.classList.remove(this.CSS_CLASS_GRAB),this.onActiveChanged&&this.onActiveChanged(!1))},toggle:function(){this.active?this.deactivate():this.activate()},ignoreTarget:function(t){return t[o]("a[href], a[href] *, input, textarea, button, button *, select, option")},_onmousedown:function(t){if(0===t.button&&!this.ignoreTarget(t.target)){if(t.originalTarget)try{t.originalTarget.tagName}catch(t){return}this.scrollLeftStart=this.element.scrollLeft,this.scrollTopStart=this.element.scrollTop,this.clientXStart=t.clientX,this.clientYStart=t.clientY,this.document.addEventListener("mousemove",this._onmousemove,!0),this.document.addEventListener("mouseup",this._endPan,!0),this.element.addEventListener("scroll",this._endPan,!0),t.preventDefault(),t.stopPropagation();var e=document.activeElement;e&&!e.contains(t.target)&&e.blur()}},_onmousemove:function(t){if(this.element.removeEventListener("scroll",this._endPan,!0),"buttons"in(e=t)&&s?1&e.buttons:!a&&!l||0!==e.which){var e,o=t.clientX-this.clientXStart,n=t.clientY-this.clientYStart,r=this.scrollTopStart-n,i=this.scrollLeftStart-o;this.element.scrollTo?this.element.scrollTo({top:r,left:i,behavior:"instant"}):(this.element.scrollTop=r,this.element.scrollLeft=i),this.overlay.parentNode||document.body.appendChild(this.overlay)}else this._endPan()},_endPan:function(){this.element.removeEventListener("scroll",this._endPan,!0),this.document.removeEventListener("mousemove",this._onmousemove,!0),this.document.removeEventListener("mouseup",this._endPan,!0),this.overlay.remove()}};var e=function(t){function o(){_classCallCheck(this,o);var t=_possibleConstructorReturn(this,(o.__proto__||Object.getPrototypeOf(o)).call(this));t.pdfjsLib=window["pdfjs-dist/build/pdf"];var e=t.shadowSelector+" .scrollview{width:"+(t.getAttribute("width")||"100%")+";height:"+(t.getAttribute("height")||"400px")+";overflow:auto;} \n"+t.shadowSelector+" canvas{cursor:pointer;} ";return t.makeShadow(),t.messages={"not-supported-message":t.getAttribute("not-supported-message")||"No pdf support","not-supported-link-message":t.getAttribute("not-supported-link-message")||"Click here to download file"},t.pdfjsLib?(t.shadowRoot.innerHTML="<style>"+e+'</style><div class="scrollview"><canvas></canvas></div>',t.theStyle=t.shadowRoot.$("style"),t.theCanvas=t.shadowRoot.$("canvas"),t.grabToPan=new n({element:t.shadowRoot.$(".scrollview")}),t.grabToPan.activate(),console.log("this.theStyle="+t.theStyle+" this.theCanvas="+t.theCanvas),t):(console.error("pdfjsLib not found"),t.shadowRoot.innerHTML=t.messages["not-supported-message"]+"<a src='"+t.file+"'>"+t.messages["not-supported-link-message"],_possibleConstructorReturn(t))}return _inherits(o,GcComponent),_createClass(o,[{key:"loadPage",value:function(r){var i=this;this.pdfdoc.getPage(r).then(function(t){var e=t.getViewport(1),o=i.theCanvas.getContext("2d");i.theCanvas.height=e.height,i.theCanvas.width=e.width;var n={canvasContext:o,viewport:e};t.render(n).then(function(){console.log("Page rendered"),i._loadingLock=!1,i.fireEvent("pagerendered",r)})})}},{key:"loadFromUrl",value:function(t){var n=this;(this.pdfdoc=null,this.pdfjsLib)?this._loadingLock?console.log("already laoading.."):(this._loadingLock=!0,this.pdfUrl=t,this.pdfjsLib.getDocument(this.pdfUrl).promise.then(function(t){try{n.pdfdoc=t;n.offsetHeight,n.offsetWidth;var e=window.getComputedStyle(n,null).getPropertyValue("height");e&&1*e,n.fireEvent("documentload");var o=n.pagenum;n.loadPage(o)}catch(t){n._loadingLock=!1,console.log("Error: "+t)}},function(t){n._loadingLock=!1,console.error(t)})):console.error("pdfjsLib not found")}},{key:"attributeChangedCallback",value:function(t,e,o){switch(t){case"file":this.loadFromUrl(o);break;case"pagenum":this.loadPage(1*o)}}},{key:"file",get:function(){return this.getAttribute("file")},set:function(t){t?this.setAttribute("file",t):this.removeAttribute("file")}},{key:"pagenum",get:function(){if(!this.getAttribute("pagenum"))return 1},set:function(t){this.setAttribute("pagenum",t)}}],[{key:"observedAttributes",get:function(){return["file","pagenum"]}}]),o}();customElements.define("gc-pdfviewer",e)}();