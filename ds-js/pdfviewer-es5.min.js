"use strict";var _createClass=function(){function r(t,e){for(var o=0;o<e.length;o++){var r=e[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(t,e,o){return e&&r(t.prototype,e),o&&r(t,o),t}}(),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}require("core-js/es6/map"),require("core-js/es6/set"),function(){function t(){this.a=new Map,this.j=new Map,this.h=new Map,this.o=new Set,this.C=new MutationObserver(this.D.bind(this)),this.f=null,this.F=new Set,this.enableFlush=!0,this.s=!1,this.m=null}function i(){return e.customElements}function l(t){if(!/^[a-z][.0-9_a-z]*-[\-.0-9_a-z]*$/.test(t)||-1!==n.indexOf(t))return Error("The element name '"+t+"' is not valid.")}function o(t,e,o,r){var n=i();return t=o?c.call(t,e,o):c.call(t,e),(e=n.a.get(e.toLowerCase()))&&n.u(t,e,r),n.b(t),t}function r(t,e,o,r){e=e.toLowerCase();var n=t.getAttribute(e);r.call(t,e,o),1==t.__$CE_upgraded&&(o=(r=i().a.get(t.localName)).A,(r=r.i)&&0<=o.indexOf(e)&&((o=t.getAttribute(e))!==n&&r.call(t,e,n,o,null)))}var s=document,e=window;if(!i()||(i().g=function(){},i().forcePolyfill)){var n="annotation-xml color-profile font-face font-face-src font-face-uri font-face-format font-face-name missing-glyph".split(" ");t.prototype.L=function(t,e){function o(t){var e=n[t];if(void 0!==e&&"function"!=typeof e)throw Error(r+" '"+t+"' is not a Function");return e}if("function"!=typeof e)throw new TypeError("constructor must be a Constructor");if(i=l(t))throw i;if(this.a.has(t))throw Error("An element with name '"+t+"' is already defined");if(this.j.has(e))throw Error("Definition failed for '"+t+"': The constructor is already used.");var r=t,n=e.prototype;if("object"!==(void 0===n?"undefined":_typeof(n)))throw new TypeError("Definition failed for '"+t+"': constructor.prototype must be an object");var i=o("connectedCallback"),s=o("disconnectedCallback"),a=o("attributeChangedCallback");this.a.set(r,{name:t,localName:r,constructor:e,v:i,w:s,i:a,A:a&&e.observedAttributes||[]}),this.j.set(e,r),this.K(),(t=this.h.get(r))&&(t.resolve(void 0),this.h.delete(r))},t.prototype.get=function(t){return(t=this.a.get(t))?t.constructor:void 0},t.prototype.M=function(t){if(r=l(t))return Promise.reject(r);if(this.a.has(t))return Promise.resolve();if(r=this.h.get(t))return r.N;var e,o=new Promise(function(t){e=t}),r={N:o,resolve:e};return this.h.set(t,r),o},t.prototype.g=function(){this.enableFlush&&(this.l(this.m.takeRecords()),this.D(this.C.takeRecords()),this.o.forEach(function(t){this.l(t.takeRecords())},this))},t.prototype.K=function(){var t=this;if(!this.s){this.s=!0;var e=function(){t.s=!1,t.m||(t.m=t.b(s)),t.c(s.childNodes)};window.HTMLImports?window.HTMLImports.whenReady(e):e()}},t.prototype.I=function(t){this.f=t},t.prototype.b=function(t){return null!=t.__$CE_observer||(t.__$CE_observer=new MutationObserver(this.l.bind(this)),t.__$CE_observer.observe(t,{childList:!0,subtree:!0}),this.enableFlush&&this.o.add(t.__$CE_observer)),t.__$CE_observer},t.prototype.J=function(t){null!=t.__$CE_observer&&(t.__$CE_observer.disconnect(),this.enableFlush&&this.o.delete(t.__$CE_observer),t.__$CE_observer=null)},t.prototype.l=function(t){for(var e=0;e<t.length;e++){var o=t[e];if("childList"===o.type){var r=o.removedNodes;this.c(o.addedNodes),this.H(r)}}},t.prototype.c=function(t,e){e=e||new Set;for(var o=0;o<t.length;o++){var r=t[o];if(r.nodeType===Node.ELEMENT_NODE)for(this.J(r),r=s.createTreeWalker(r,NodeFilter.SHOW_ELEMENT,null,!1);this.G(r.currentNode,e),r.nextNode(););}},t.prototype.G=function(t,e){if(!e.has(t)){e.add(t);var o=this.a.get(t.localName);if(o){var r;if(t.__$CE_upgraded||this.u(t,o,!0),r=t.__$CE_upgraded&&!t.__$CE_attached)t:{r=t;do{if(r.__$CE_attached||r.nodeType===Node.DOCUMENT_NODE){r=!0;break t}r=r.parentNode||r.nodeType===Node.DOCUMENT_FRAGMENT_NODE&&r.host}while(r);r=!1}r&&(t.__$CE_attached=!0,o.v&&o.v.call(t))}t.shadowRoot&&this.c(t.shadowRoot.childNodes,e),"LINK"===t.tagName&&t.rel&&-1!==t.rel.toLowerCase().split(" ").indexOf("import")&&this.B(t,e)}},t.prototype.B=function(e,t){var o=e.import;if(o)t.has(o)||(t.add(o),o.__$CE_observer||this.b(o),this.c(o.childNodes,t));else if(t=e.href,!this.F.has(t)){this.F.add(t);var r=this;e.addEventListener("load",function t(){e.removeEventListener("load",t),e.import.__$CE_observer||r.b(e.import),r.c(e.import.childNodes)})}},t.prototype.H=function(t){for(var e=0;e<t.length;e++){var o=t[e];if(o.nodeType===Node.ELEMENT_NODE){this.b(o),o=s.createTreeWalker(o,NodeFilter.SHOW_ELEMENT,null,!1);do{var r=o.currentNode;if(r.__$CE_upgraded&&r.__$CE_attached){r.__$CE_attached=!1;var n=this.a.get(r.localName);n&&n.w&&n.w.call(r)}}while(o.nextNode())}}},t.prototype.u=function(t,e,o){if(t.__proto__=e.constructor.prototype,o&&(this.I(t),new e.constructor,t.__$CE_upgraded=!0,console.assert(!this.f)),o=e.A,(e=e.i)&&0<o.length){this.C.observe(t,{attributes:!0,attributeOldValue:!0,attributeFilter:o});for(var r=0;r<o.length;r++){var n=o[r];if(t.hasAttribute(n)){var i=t.getAttribute(n);e.call(t,n,null,i,null)}}}},t.prototype.D=function(t){for(var e=0;e<t.length;e++){var o=t[e];if("attributes"===o.type){var r=o.target,n=this.a.get(r.localName),i=o.attributeName,s=o.oldValue,a=r.getAttribute(i);a!==s&&n.i.call(r,i,s,a,o.attributeNamespace)}}},(window.CustomElementRegistry=t).prototype.define=t.prototype.L,t.prototype.get=t.prototype.get,t.prototype.whenDefined=t.prototype.M,t.prototype.flush=t.prototype.g,t.prototype.polyfilled=!0,t.prototype._observeRoot=t.prototype.b,t.prototype._addImport=t.prototype.B;var a=e.HTMLElement;t.prototype.nativeHTMLElement=a,e.HTMLElement=function(){var t=i();if(t.f){var e=t.f;return t.f=null,e}if(this.constructor)return t=t.j.get(this.constructor),o(s,t,void 0,!1);throw Error("Unknown constructor. Did you call customElements.define()?")},e.HTMLElement.prototype=a.prototype;var c=s.createElement;s.createElement=function(t,e){return o(s,t,e,!0)};var u=s.createElementNS;s.createElementNS=function(t,e){return"http://www.w3.org/1999/xhtml"===t?s.createElement(e):u.call(s,t,e)};var h=Element.prototype.attachShadow;h&&Object.defineProperty(Element.prototype,"attachShadow",{value:function(t){return t=h.call(this,t),i().b(t),t}});var d=s.importNode;s.importNode=function(t,e){return t=d.call(s,t,e),i().c(t.nodeType===Node.ELEMENT_NODE?[t]:t.childNodes),t};var f=Element.prototype.setAttribute;Element.prototype.setAttribute=function(t,e){r(this,t,e,f)};var p=Element.prototype.removeAttribute;Element.prototype.removeAttribute=function(t){r(this,t,null,p)},Object.defineProperty(window,"customElements",{value:new t,configurable:!0,enumerable:!0}),window.CustomElements={takeRecords:function(){i().g&&i().g()}}}}();var GcComponent=function(t){function e(){_classCallCheck(this,e);var t=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t._cache={events:{}},t}return _inherits(e,HTMLElement),_createClass(e,[{key:"$",value:function(t){return this.querySelector(t)}},{key:"$$",value:function(t){return this.querySelectorAll(t)}},{key:"fireEvent",value:function(t,e){var o=!(2<arguments.length&&void 0!==arguments[2])||arguments[2],r=JSON.stringify(arguments);if(!(r in this._cache.events)){var n={bubbles:o};e instanceof Object&&(n.detail=e),this._cache.events[r]=new CustomEvent(t,n)}this.dispatchEvent(this._cache.events[r])}},{key:"loadScript",value:function(t,e){console.log("Loading "+t);var o=document.getElementsByTagName("head")[0],r=document.createElement("script");r.type="text/javascript",r.src=t,r.onload=e,o.appendChild(r)}},{key:"guid",value:function(){function t(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t()}},{key:"makeShadow",value:function(){var e=this;0<arguments.length&&void 0!==arguments[0]&&arguments[0];"ShadyCSS"in window&&ShadyCSS.styleElement(this),-1!=window.customElements.toString().indexOf("CustomElementRegistry")?(console.log("Good browser, use Shadow DOM"),this.attachShadow({mode:"open"})):(console.log("Not good browser, don't use Shadow DOM"),this.shadowRoot=this),this.shadowRoot.$=function(t){return e.shadowRoot.querySelector(t)},this.shadowRoot.$$=function(t){return new CustomNodeList(e.shadowRoot.querySelectorAll(t))}}},{key:"is",get:function(){return this.localName}}]),e}(),GcPdfViewer=function(t){function e(){_classCallCheck(this,e);var t=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t.pdfjsLib=window["pdfjs-dist/build/pdf"],t.cssStyle="",t.makeShadow(),t.messages={"not-supported-message":t.getAttribute("not-supported-message")||"No pdf support","not-supported-link-message":t.getAttribute("not-supported-link-message")||"Click here to download file"},t.pdfjsLib?(t.shadowRoot.innerHTML="<style>"+t.cssStyle+'</style><canvas class="the-canvas"></canvas>',t.theStyle=t.shadowRoot.$("style"),t.theCanvas=t.shadowRoot.$(".the-canvas"),console.log("this.theStyle="+t.theStyle+" this.theCanvas="+t.theCanvas),t):(console.error("pdfjsLib not found"),t.shadowRoot.innerHTML=t.messages["not-supported-message"]+"<a src='"+t.file+"'>"+t.messages["not-supported-link-message"],_possibleConstructorReturn(t))}return _inherits(e,GcComponent),_createClass(e,[{key:"loadPage",value:function(n){var i=this;this.pdfdoc.getPage(n).then(function(t){var e=t.getViewport(1),o=i.theCanvas.getContext("2d");i.theCanvas.height=e.height,i.theCanvas.width=e.width;var r={canvasContext:o,viewport:e};t.render(r).then(function(){console.log("Page rendered"),i._loadingLock=!1,i.fireEvent("pagerendered",n)})})}},{key:"loadFromUrl",value:function(t){var r=this;(this.pdfdoc=null,this.pdfjsLib)?this._loadingLock?console.log("already laoading.."):(this._loadingLock=!0,this.pdfUrl=t,this.pdfjsLib.getDocument(this.pdfUrl).promise.then(function(t){try{r.pdfdoc=t;r.offsetHeight,r.offsetWidth;var e=window.getComputedStyle(r,null).getPropertyValue("height");e&&1*e,r.fireEvent("documentload");var o=r.pagenum;r.loadPage(o)}catch(t){r._loadingLock=!1,console.log("Error: "+t)}},function(t){r._loadingLock=!1,console.error(t)})):console.error("pdfjsLib not found")}},{key:"attributeChangedCallback",value:function(t,e,o){switch(t){case"file":this.loadFromUrl(o);break;case"pagenum":this.loadPage(1*o)}}},{key:"file",get:function(){return this.getAttribute("file")},set:function(t){t?this.setAttribute("file",t):this.removeAttribute("file")}},{key:"pagenum",get:function(){if(!this.getAttribute("pagenum"))return 1},set:function(t){this.setAttribute("pagenum",t)}}],[{key:"observedAttributes",get:function(){return["file","pagenum"]}}]),e}();customElements.define("gc-pdfviewer",GcPdfViewer);